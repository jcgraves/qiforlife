---
import Layout from '../layouts/Layout.astro';
import { Image } from 'astro:assets';
import { getEntry } from 'astro:content';
import officeInterior from '../images/office-interior.jpg';
import waitingRoom from '../images/waiting-room.jpg';
import shrineImage from '../images/Qi_For_Life_Shrine.jpg';

// Load contact page content
const hero = await getEntry('contact', 'hero');
const formContent = await getEntry('contact', 'form');
const infoContent = await getEntry('contact', 'info');
const gallery = await getEntry('contact', 'gallery');

// Load business settings
const business = await getEntry('settings', 'business');
---

<Layout
  title="Contact"
  description={`Schedule your acupuncture appointment with Dr. Li Zhang in ${business?.data.city}, ${business?.data.state}. Call ${business?.data.phone} or email ${business?.data.email}. Located at ${business?.data.streetAddress} ${business?.data.suite}.`}
>
  <!-- Hero Section -->
  <section class="page-hero">
    <div class="container">
      <span class="section-label">{hero?.data.sectionLabel}</span>
      <h1>{hero?.data.title}</h1>
      <p class="page-hero__subtitle">{hero?.data.subtitle}</p>
    </div>
  </section>

  <!-- Contact Content -->
  <section class="contact-main section section--white">
    <div class="container">
      <div class="contact-grid">
        <!-- Contact Info -->
        <div class="contact-info">
          <h2>{infoContent?.data.heading}</h2>
          <div class="divider divider--left"></div>
          <p class="contact-info__intro">{infoContent?.data.introText}</p>

          <div class="contact-details">
            <div class="contact-detail">
              <h3>Location</h3>
              <address>
                {business?.data.streetAddress}<br />
                {business?.data.suite}<br />
                {business?.data.city}, {business?.data.state} {business?.data.zipCode}
              </address>
            </div>

            <div class="contact-detail">
              <h3>Phone</h3>
              <p><a href={`tel:+1${business?.data.phone.replace(/-/g, '')}`}>{business?.data.phone}</a></p>
            </div>

            <div class="contact-detail">
              <h3>Email</h3>
              <p><a href={`mailto:${business?.data.email}`}>{business?.data.email}</a></p>
            </div>

            <div class="contact-detail">
              <h3>Hours</h3>
              <p class="hours-note">By Appointment Only</p>
              <ul class="hours-list">
                <li><span>{business?.data.hours.openDays}</span><span>{business?.data.hours.openTime} - {business?.data.hours.closeTime}</span></li>
                <li><span>{business?.data.hours.closedDays}</span><span>Closed</span></li>
              </ul>
            </div>
          </div>
        </div>

        <!-- Contact Form -->
        <div class="contact-form-wrapper">
          <h2>{formContent?.data.heading}</h2>
          <div class="divider divider--left"></div>
          <p class="contact-form__intro">{formContent?.data.introText}</p>

          <form class="contact-form" name="appointment" method="POST" data-netlify="true" netlify-honeypot="bot-field">
            <input type="hidden" name="form-name" value="appointment" />
            <p class="hidden" style="display: none;">
              <label>Don't fill this out if you're human: <input name="bot-field" /></label>
            </p>

            <div class="form-row">
              <div class="form-group">
                <label for="firstName">First Name <span class="required">*</span></label>
                <input type="text" id="firstName" name="firstName" required />
              </div>
              <div class="form-group">
                <label for="lastName">Last Name <span class="required">*</span></label>
                <input type="text" id="lastName" name="lastName" required />
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="email">Email <span class="required">*</span></label>
                <input type="email" id="email" name="email" required />
              </div>
              <div class="form-group">
                <label for="phone">Phone <span class="required">*</span></label>
                <input type="tel" id="phone" name="phone" required />
              </div>
            </div>

            <div class="form-group">
              <label for="visitType">Type of Visit</label>
              <select id="visitType" name="visitType">
                <option value="">Select one...</option>
                <option value="new">New Patient Appointment</option>
                <option value="followup">Follow-Up Appointment</option>
                <option value="question">General Inquiry</option>
              </select>
            </div>

            <div class="form-group">
              <label for="concern">Primary Health Concern</label>
              <textarea id="concern" name="concern" rows="4" placeholder="Please briefly describe your primary health concern or reason for visit..."></textarea>
            </div>

            <div class="form-group">
              <label for="preferredContact">Preferred Contact Method</label>
              <select id="preferredContact" name="preferredContact">
                <option value="phone">Phone</option>
                <option value="email">Email</option>
              </select>
            </div>

            <button type="submit" class="btn btn--primary">{formContent?.data.submitButtonText}</button>
          </form>
        </div>
      </div>
    </div>
  </section>

  <!-- Map Section -->
  <section class="map-section">
    <div class="map-container">
      <iframe
        src={business?.data.mapsUrl}
        width="100%"
        height="400"
        style="border:0;"
        allowfullscreen=""
        loading="lazy"
        referrerpolicy="no-referrer-when-downgrade"
        title={`${business?.data.businessName} Location`}>
      </iframe>
    </div>
  </section>

  <!-- Office Images -->
  <section class="office-images section section--cream">
    <div class="container">
      <div class="section-header">
        <span class="section-label">{gallery?.data.sectionLabel}</span>
        <h2>{gallery?.data.heading}</h2>
      </div>
      <div class="office-gallery">
        <Image
          src={shrineImage}
          alt="Qi For Life Acupuncture clinic sign - Body, Mind, Spirit for good Health"
          widths={[400, 600, 800]}
          sizes="(max-width: 900px) 100vw, 33vw"
          width={800}
          height={533}
          loading="lazy"
          format="webp"
          quality={70}
        />
        <Image
          src={waitingRoom}
          alt="Qi For Life Acupuncture waiting room"
          widths={[400, 600, 800]}
          sizes="(max-width: 900px) 100vw, 33vw"
          width={800}
          height={533}
          loading="lazy"
          format="webp"
          quality={70}
        />
        <Image
          src={officeInterior}
          alt="Qi For Life Acupuncture clinic interior"
          widths={[400, 600, 800]}
          sizes="(max-width: 900px) 100vw, 33vw"
          width={800}
          height={533}
          loading="lazy"
          format="webp"
          quality={70}
        />
      </div>
    </div>
  </section>
</Layout>

<style>
  /* Page Hero */
  .page-hero {
    background-color: var(--color-charcoal);
    color: var(--color-warm-white);
    padding: var(--space-3xl) 0 var(--space-2xl);
    text-align: center;
  }
  
  .page-hero h1 {
    color: var(--color-warm-white);
    margin-bottom: var(--space-xs);
  }
  
  .page-hero__subtitle {
    font-size: 1.125rem;
    color: var(--color-gold);
    font-weight: 500;
    letter-spacing: 0.05em;
  }
  
  /* Contact Grid */
  .contact-grid {
    display: grid;
    grid-template-columns: 1fr 1.2fr;
    gap: var(--space-3xl);
  }
  
  @media (max-width: 900px) {
    .contact-grid {
      grid-template-columns: 1fr;
      gap: var(--space-2xl);
    }
  }
  
  /* Contact Info */
  .contact-info h2,
  .contact-form-wrapper h2 {
    margin-bottom: var(--space-xs);
  }
  
  .contact-info__intro,
  .contact-form__intro {
    color: var(--color-warm-gray);
    margin-bottom: var(--space-xl);
  }
  
  .contact-details {
    display: flex;
    flex-direction: column;
    gap: var(--space-lg);
  }
  
  .contact-detail h3 {
    font-size: 0.75rem;
    font-family: var(--font-body);
    font-weight: 600;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--color-gold);
    margin-bottom: var(--space-xs);
  }
  
  .contact-detail address {
    font-style: normal;
    color: var(--color-charcoal);
    line-height: 1.7;
  }
  
  .contact-detail p {
    margin: 0;
  }
  
  .contact-detail a {
    color: var(--color-charcoal);
    font-weight: 500;
  }
  
  .contact-detail a:hover {
    color: var(--color-burgundy);
  }
  
  .hours-note {
    font-style: italic;
    color: var(--color-sage-dark);
    margin-bottom: var(--space-sm);
  }
  
  .hours-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }
  
  .hours-list li {
    display: flex;
    justify-content: space-between;
    padding: var(--space-xs) 0;
    border-bottom: 1px solid rgba(44, 62, 45, 0.1);
    max-width: 250px;
  }
  
  /* Contact Form */
  .contact-form {
    background: var(--color-cream);
    padding: var(--space-xl);
    border-radius: 4px;
  }
  
  .form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--space-md);
  }
  
  @media (max-width: 600px) {
    .form-row {
      grid-template-columns: 1fr;
    }
  }
  
  .form-group {
    margin-bottom: var(--space-md);
  }
  
  .form-group label {
    display: block;
    margin-bottom: var(--space-xs);
    font-weight: 500;
    color: var(--color-charcoal);
  }
  
  .required {
    color: var(--color-burgundy);
  }
  
  .contact-form .btn {
    width: 100%;
    margin-top: var(--space-sm);
  }
  
  /* Map Section */
  .map-section {
    background: var(--color-charcoal);
  }
  
  .map-container {
    height: 400px;
  }
  
  .map-container iframe {
    display: block;
  }
  
  /* Office Gallery */
  .office-gallery {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: var(--space-lg);
  }

  .office-gallery img {
    border-radius: 4px;
    box-shadow: var(--shadow-md);
    width: 100%;
    aspect-ratio: 3/2;
    object-fit: cover;
  }

  @media (max-width: 900px) {
    .office-gallery {
      grid-template-columns: 1fr 1fr;
    }

    .office-gallery img:first-child {
      grid-column: span 2;
    }
  }

  @media (max-width: 640px) {
    .office-gallery {
      grid-template-columns: 1fr;
    }

    .office-gallery img:first-child {
      grid-column: span 1;
    }
  }
</style>
